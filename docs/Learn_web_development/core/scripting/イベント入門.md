# イベント入門

[イベント入門 - MDN](https://developer.mozilla.org/ja/docs/Learn_web_development/Core/Scripting/Events)

## イベントとは

- イベント = ブラウザーが「何か重要なことが起こった」ときに発行するシグナル
- 例: ユーザーがボタンをクリックしたら → それに応じてコードを実行できる

## 前提知識

- HTML / CSS の基礎
- 基本的な JavaScript

## 学習のポイント

- イベントはブラウザーが発行する通知で、開発者はそれに応答できる
- イベントハンドラーの設定方法
  - `addEventListener()` / `removeEventListener()`
  - イベントハンドラープロパティ（例: `onclick`）
- インラインイベントハンドラー属性は使うべきではない
- イベントオブジェクトを使って詳細情報を扱える

# イベントとは何か

## イベントの基本

- イベント = システムで発生する出来事を示すシグナル（発火する）
- イベントが発生すると、それに応じてコード（アクション）が自動的に実行される

イベントはブラウザーウィンドウ内で起こり、特定のアイテムに結びつく  
（要素、要素の集合、HTML 文書全体、ブラウザーウィンドウなど）

## 代表的なイベントの種類

- ユーザーが要素をクリック / ホバーする
- キーボードのキー入力
- ウィンドウのリサイズやクローズ
- ページの読み込み完了
- フォーム送信
- 動画の再生・停止・終了
- エラー発生

## イベントリスナーとイベントハンドラー

- イベントに反応するには「イベントリスナー」を割り当てる
- イベントリスナーはイベントを待ち受け、発生したら「イベントハンドラー関数」を実行する
- この仕組みを **イベントハンドラーの登録** という

## 例：クリックイベント

### HTML

```html
<!-- html -->
<button>色を変更</button>
```

```js
// js
const btn = document.querySelector("button");

function random(number) {
  return Math.floor(Math.random() * (number + 1));
}

btn.addEventListener("click", () => {
  const rndCol = `rgb(${random(255)} ${random(255)} ${random(255)})`;
  document.body.style.backgroundColor = rndCol;
});
```

# addEventListener() の使用

## 基本

- イベントを発行できるオブジェクトは `addEventListener()` を持つ
- イベントリスナーを登録する推奨方法
- 引数は 2 つ：
  1. 文字列（イベントの種類: `"click"`, `"mouseover"`, `"keydown"` など）
  2. イベントが発生したときに呼び出す関数

# 他のイベントの待ち受け

## イベントハンドラープロパティの種類

- `click` 以外にもさまざまなイベントがある
- 実験用に、ランダムカラー変更のサンプルで確認可能

### 例：主なイベント

- `focus` / `blur`

  - タブキーで要素にフォーカスが当たったり外れたりしたとき
  - フォーム入力時の情報表示やエラーメッセージに使用

- `dblclick`

  - ダブルクリック時に反応

- `mouseover` / `mouseout`
  - マウスポインターが要素上に来たとき / 外れたときに反応

### 注意

- `click` はほぼ全ての要素で利用可能
- 一部のイベントは特定の要素でのみ利用可能

  - 例: `play` は `<video>` 要素の再生開始時に発火

- イベントを理解することで、ユーザーの操作に応じた柔軟な反応が可能になる

# リスナーの除去

- `addEventListener()` で追加したイベントリスナーは、必要に応じて削除できる
- 削除には `removeEventListener()` を使用

### 例

```js
btn.removeEventListener("click", changeBackground);
```

# 単一のイベントに複数の待ち受けを追加

- `addEventListener()` を複数回呼び出すことで、同じイベントに対して複数のハンドラーを登録できる

### 例

```js
// この場合、myElement がクリックされると、functionA と functionB の両方が順に実行される
myElement.addEventListener("click", functionA);
myElement.addEventListener("click", functionB);
```

# イベントリスナーの他の機構

## 推奨方法

- `addEventListener()` が最も強力で複雑なプログラム向き

## 他の方法

### イベントハンドラープロパティ

- イベント名の前に `on` を付けたプロパティ（例: `onclick`）を使う
- ハンドラー関数をプロパティに割り当てることで登録できる

#### 例：無名関数

```js
// 無名関数
const btn = document.querySelector("button");

function random(number) {
  return Math.floor(Math.random() * (number + 1));
}

btn.onclick = () => {
  const rndCol = `rgb(${random(255)} ${random(255)} ${random(255)})`;
  document.body.style.backgroundColor = rndCol;
};
```

```js
// 名前付き関数
const btn = document.querySelector("button");

function random(number) {
  return Math.floor(Math.random() * (number + 1));
}

function bgChange() {
  const rndCol = `rgb(${random(255)} ${random(255)} ${random(255)})`;
  document.body.style.backgroundColor = rndCol;
}

btn.onclick = bgChange;
```

```js
// ハンドラープロパティでは 1つのイベントに複数リスナーを追加できない

element.onclick = function1;
element.onclick = function2; // function1 は上書きされる
```

# イベントオブジェクト

- イベントハンドラー関数内で `event`、`e`、`evt` として渡される引数は **イベントオブジェクト**
- イベントに関する情報や追加機能を提供する

## ポイント

- **`e.target` はイベントが発生した要素への参照 → 要注意！**
- この例ではボタンの背景色だけが変わる
- 引数名は自由（`e`、`evt`、`event` が一般的）
- 一貫性を持って命名するとコードが読みやすくなる

### 例：ランダム背景色変更にイベントオブジェクトを使用

```js
const btn = document.querySelector("button");

function random(number) {
  return Math.floor(Math.random() * (number + 1));
}

function bgChange(e) {
  const rndCol = `rgb(${random(255)} ${random(255)} ${random(255)})`;
  e.target.style.backgroundColor = rndCol; // クリックされたボタン自身を操作
  console.log(e); // イベントオブジェクトを出力
}

btn.addEventListener("click", bgChange);
```

# イベントオブジェクトの追加プロパティ

- ほとんどのイベントオブジェクトは標準のプロパティとメソッドを持つ
- 詳細は [Event オブジェクトリファレンス](https://developer.mozilla.org/ja/docs/Web/API/Event) を参照

- 一部のイベントは特定のプロパティを追加で持つ
  - 例: `keydown` イベント → `KeyboardEvent` オブジェクト
  - `key` プロパティで押されたキーを取得可能

### HTML

```html
<input id="textBox" type="text" />
<div id="output"></div>
```

```js
const textBox = document.querySelector("#textBox");
const output = document.querySelector("#output");

textBox.addEventListener("keydown", (event) => {
  output.textContent = `"${event.key}" が押されました。`;
});
```

# 既定の動作の抑制

- あるイベントでブラウザーが通常行う動作を抑制したい場合がある
- 例: フォーム送信時にサーバーにデータが送信される既定動作を止めて、自前の検証処理を行う

## HTML フォーム例

```html
<form action="#">
  <div>
    <label for="fname">姓: </label>
    <input id="fname" type="text" />
  </div>
  <div>
    <label for="lname">名: </label>
    <input id="lname" type="text" />
  </div>
  <div>
    <input id="submit" type="submit" />
  </div>
</form>
<p></p>
```

ポイント

- submit イベントが発生すると、入力内容をチェック
- 空欄があれば preventDefault() で送信を止める
- フォーム下にエラーメッセージを表示
- 簡単な検証例として利用可能

```js
const form = document.querySelector("form");
const fname = document.getElementById("fname");
const lname = document.getElementById("lname");
const para = document.querySelector("p");

form.addEventListener("submit", (e) => {
  if (fname.value === "" || lname.value === "") {
    e.preventDefault(); // 既定の送信動作を抑制
    para.textContent = "You need to fill in both names!"; // エラーメッセージ表示
  }
});
```

# ウェブページだけではない

- イベントは JavaScript 固有ではなく、ほとんどのプログラミング言語に存在
- 各環境でイベントモデルの動作は異なる

### 例 1: Node.js

- JavaScript ランタイムで、ネットワークやサーバーサイドアプリ開発に使用
- イベントモデルは **イベントエミッター** と **イベントリスナー** で構成
- `on()` でリスナー登録、`once()` で一度だけ実行されるリスナー登録
- HTTP の `connect` イベントなどが例としてドキュメントに記載

### 例 2: WebExtensions

- クロスブラウザーのアドオン開発に使用
- ウェブイベントモデルに似ているが、細部が異なる
- イベントリスナーのプロパティはキャメルケース（例: `onMessage`）
- `addListener()` でイベントリスナーを登録

> この段階では他の環境の詳細は理解する必要はない  
> プログラミング環境によってイベントが異なる可能性があることを認識するだけで十分

---


# イベントバブリング（Event Bubbling）

イベントバブリングは、ウェブページの DOM で発生する **イベントの伝播の仕組み** の一つ。  
簡単に言うと、子要素で発生したイベントが **親要素へ順に伝わっていく現象** のこと。

---

## ポイント

- ある要素でイベントが発生すると、そのイベントは  
  **その要素 → 親要素 → さらに上位の祖先要素 → 最終的に `document` まで** 伝わる
- これにより、親要素でも同じイベントを捕捉できる

---

## 例

```html
<div id="parent">
  <button id="child">クリック</button>
</div>
```

```js
const parent = document.getElementById("parent");
const child = document.getElementById("child");

child.addEventListener("click", () => {
  console.log("子要素がクリックされました");
});

parent.addEventListener("click", () => {
  console.log("親要素でもクリックイベントが発生");
});
```
